<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Persistent Calendar with Textareas (Multi-Calendar)</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      font-family: Arial, sans-serif;
    }

    /* Header bar */
    .header {
      height: 15px;
      background: black;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 10px;
      font-weight: bold;
      cursor: pointer;
    }
    .header button {
      background: none;
      border: none;
      color: #fff;
      font-size: 12px;
      cursor: pointer;
    }
    .header .title {
      display:flex;
      gap:4px;
      align-items:center;
      font-size:14px;
    }
    .header .calendar-name {
      font-weight: normal;
      font-size: 10px;
      opacity: 0.9;
    }

    /* Weekday bar */
    .weekdays {
      height: 10px;
      background: #eaeaea;
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      font-size: 10px;
      line-height: 10px;
      border-bottom: 1px solid #ccc;
    }

    /* Calendar grid fills remaining viewport */
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-auto-rows: 1fr;
      height: calc(106.3% - 64px); /* header + weekday bar */
    }

    .day {
      border: 1px solid #ddd;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .day-label {
      flex: 0 0 1px; /* CHECK THIS GREYBUG */
      background: #f4f4f4;
      font-size: 8px;
      padding: 1px;
      border-bottom: 1px solid #ddd;
    }

    .day textarea {
      flex: 1;
      width: 100%;
      border: none;
      resize: none;
      padding: 1px;
      font-size: 10px;
      outline: none;
      box-sizing: border-box;
      overflow: hidden;
      background: transparent;
    }

    .today {
      background: black;
      color: #fff;
      font-weight: bold;
    }

    /* Floating button */
    .fab {
      position: fixed;
      right: 18px;
      bottom: 18px;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #171a21;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
      cursor: pointer;
      z-index: 1000;
    }

    /* Calendar menu */
    .fab-menu {
      position: fixed;
      right: 18px;
      bottom: 55px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.15);
      padding: 8px;
      display: none;
      z-index: 1000;
      width: 220px;
      max-height: 320px;
      overflow: auto;
    }
    .fab-menu.show { display: block; }

    .fab-menu .cal-item {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
    }
    .fab-menu .cal-item:hover { background: #c7d5e0; }
    .fab-menu .cal-item.active { background: #2a475e; color: #fff; }

    /* small label for month */
    #monthYear {
      transition: color 0.3s ease;
      cursor: pointer;
    }
    #monthYear:hover { color: #ddd; }

    /* responsive tweaks */
    @media (max-width: 600px) {
      .fab-menu { width: 180px; }
    }
  </style>
</head>
<body>
  <div class="header">
    <button id="prev">&#9664;</button>
    <div class="title">
      <div id="monthYear"></div>
      <div class="calendar-name" id="currentCalendarName"></div>
    </div>
    <button id="next">&#9654;</button>
  </div>

  <div class="weekdays">
    <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div>
    <div>Thu</div><div>Fri</div><div>Sat</div>
  </div>

  <div class="calendar" id="calendar"></div>

  <!-- Floating action button -->
  <div class="fab" id="fab">â˜°</div>

  <!-- Menu with 10 calendars -->
  <div class="fab-menu" id="fabMenu" role="menu" aria-hidden="true"></div>

  <script>
    const monthYear = document.getElementById("monthYear");
    const currentCalendarName = document.getElementById("currentCalendarName");
    const calendar = document.getElementById("calendar");
    const prevBtn = document.getElementById("prev");
    const nextBtn = document.getElementById("next");
    const fab = document.getElementById("fab");
    const fabMenu = document.getElementById("fabMenu");

    const today = new Date();
    let date = new Date(today);

    // Predefined 10 calendars (you can rename)
    const calendars = [
      { id: "cal0", name: "Personal" },
      { id: "cal1", name: "Work" },
      { id: "cal2", name: "Family" },
      { id: "cal3", name: "Fitness" },
      { id: "cal4", name: "Travel" },
      { id: "cal5", name: "Projects" },
      { id: "cal6", name: "School" },
      { id: "cal7", name: "Finance" },
      { id: "cal8", name: "Hobbies" },
      { id: "cal9", name: "Archive" }
    ];

    // Load selected calendar from localStorage or default to first
    let selectedCalendarId = localStorage.getItem("selectedCalendarId") || calendars[0].id;

    function buildFabMenu() {
      fabMenu.innerHTML = "";
      calendars.forEach(cal => {
        const item = document.createElement("div");
        item.className = "cal-item";
        if (cal.id === selectedCalendarId) item.classList.add("active");
        item.textContent = cal.name;
        const badge = document.createElement("span");
        badge.style.fontSize = "11px";
        badge.style.opacity = "0.9";
        badge.textContent = cal.id;
        item.appendChild(badge);
        item.addEventListener("click", () => {
          selectedCalendarId = cal.id;
          localStorage.setItem("selectedCalendarId", selectedCalendarId);
          fabMenu.classList.remove("show");
          renderCalendar();
        });
        fabMenu.appendChild(item);
      });
    }

    function renderCalendar() {
      const year = date.getFullYear();
      const month = date.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      const calObj = calendars.find(c => c.id === selectedCalendarId) || calendars[0];
      monthYear.textContent = date.toLocaleString("default", { month: "long" }) + " " + year;
      currentCalendarName.textContent = calObj.name;

      calendar.innerHTML = "";

      // Empty cells before first day
      for (let i = 0; i < firstDay; i++) {
        const emptyCell = document.createElement("div");
        emptyCell.className = "day";
        calendar.appendChild(emptyCell);
      }

      // Days
      for (let day = 1; day <= daysInMonth; day++) {
        const cell = document.createElement("div");
        cell.className = "day";

        const label = document.createElement("div");
        label.className = "day-label";
        label.textContent = day;

        // Highlight today
        if (
          day === today.getDate() &&
          month === today.getMonth() &&
          year === today.getFullYear()
        ) {
          label.classList.add("today");
        }

        const textarea = document.createElement("textarea");
        const key = `${selectedCalendarId}|${year}-${month}-${day}`;

        // Load saved note
        textarea.value = localStorage.getItem(key) || "";

        // Save on input (debounce to reduce writes)
        let saveTimer = null;
        textarea.addEventListener("input", () => {
          clearTimeout(saveTimer);
          saveTimer = setTimeout(() => {
            localStorage.setItem(key, textarea.value);
          }, 300);
        });

        cell.appendChild(label);
        cell.appendChild(textarea);
        calendar.appendChild(cell);
      }

      // Rebuild menu to update active state
      buildFabMenu();
    }

    prevBtn.addEventListener("click", () => {
      date.setMonth(date.getMonth() - 1);
      renderCalendar();
    });

    nextBtn.addEventListener("click", () => {
      date.setMonth(date.getMonth() + 1);
      renderCalendar();
    });

    // Click month label to jump back to today
    monthYear.addEventListener("click", () => {
      date = new Date(today);
      renderCalendar();
    });

    // FAB toggle
    fab.addEventListener("click", (e) => {
      e.stopPropagation();
      fabMenu.classList.toggle("show");
      fabMenu.setAttribute("aria-hidden", fabMenu.classList.contains("show") ? "false" : "true");
    });

    // Close menu when clicking outside
    document.addEventListener("click", (e) => {
      if (!fabMenu.contains(e.target) && e.target !== fab) {
        fabMenu.classList.remove("show");
        fabMenu.setAttribute("aria-hidden", "true");
      }
    });

    // Keyboard: Esc closes menu
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        fabMenu.classList.remove("show");
        fabMenu.setAttribute("aria-hidden", "true");
      }
    });

    // Initialize
    buildFabMenu();
    renderCalendar();
  </script>
</body>
</html>

